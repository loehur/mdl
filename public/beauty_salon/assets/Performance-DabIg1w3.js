import{_ as F,r as y,j as O,l as $,c as r,a as t,m as K,e as B,v as j,d as g,F as f,p as m,w as P,f as I,t as i,T as U,o as n}from"./index-CpgNnZR1.js";const z={class:"max-w-7xl mx-auto space-y-6"},A={class:"flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-100"},H={class:"flex items-center gap-2"},R={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},W={class:"overflow-x-auto"},Y={class:"w-full text-left border-collapse"},q={class:"divide-y divide-gray-50"},G={key:0,class:"animate-pulse"},J={key:1},Q={class:"px-6 py-4"},X={class:"flex items-center gap-3"},Z={class:"w-8 h-8 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center font-bold text-xs ring-2 ring-white shadow-sm"},tt={class:"font-medium text-gray-700"},et={class:"px-6 py-4 text-sm text-gray-500"},st={class:"flex flex-wrap gap-1.5"},at={class:"ml-1 font-bold text-gray-800"},nt={class:"px-6 py-4 text-center"},ot=["onClick"],rt={class:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl max-h-[80vh] flex flex-col animate-fade-in-down border border-gray-100"},lt={class:"p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-2xl"},it={class:"font-bold text-gray-800 flex items-center gap-2"},dt={class:"w-8 h-8 rounded-full bg-pink-600 text-white flex items-center justify-center text-xs shadow-md"},ct={class:"text-pink-600"},pt={class:"px-6 py-4 bg-gray-50/50 border-b border-gray-100"},ut={class:"flex flex-wrap gap-2"},xt={class:"bg-pink-100 text-pink-700 px-1.5 py-0.5 rounded text-[10px] font-bold"},yt={key:0,class:"text-xs text-gray-400 italic"},gt={class:"p-0 overflow-y-auto flex-1"},ft={class:"w-full text-sm"},mt={class:"divide-y divide-gray-100"},bt={class:"px-4 py-3 text-gray-500 whitespace-nowrap font-mono text-xs"},ht={class:"px-4 py-3 font-medium text-gray-700"},_t={class:"px-4 py-3 text-gray-600"},vt={key:0},kt={class:"p-4 border-t bg-gray-50 rounded-b-2xl text-right flex justify-between items-center"},wt={class:"text-sm text-gray-500 font-medium"},Dt={__name:"Performance",setup(Tt){const b=y(!0),h=y([]),l=y(null),k=y([]),_=new Date,N=new Date(_.getFullYear(),_.getMonth(),1),w=a=>a.toISOString().split("T")[0],p=O({startDate:w(N),endDate:w(_)});async function C(){try{const e=await(await fetch("/api/Beauty_Salon/Therapists")).json();e.success&&(k.value=e.data)}catch{}}async function D(){b.value=!0;try{const e=await(await fetch("/api/Beauty_Salon/Orders")).json();e.success&&L(e.data)}catch(a){console.error(a)}finally{b.value=!1}}function L(a){const e={};k.value.forEach(o=>{e[o.id]={workerId:o.id,name:o.nama,totalTasks:0,tasks:[],statsByStep:{}}});const s=new Date(p.startDate),d=new Date(p.endDate);d.setHours(23,59,59),a.forEach(o=>{const u=o.order_date||o.created_at;if(!u)return;const S=new Date(u);S<s||S>d||o.status!=="cancelled"&&(o.order_items||[]).forEach(V=>{(V.work_steps||[]).forEach(x=>{if(x.worker_id&&x.status==="completed"){const c=x.worker_id;e[c]||(e[c]={workerId:c,name:"Terapis #"+c,totalTasks:0,tasks:[],statsByStep:{}}),e[c].totalTasks++,e[c].tasks.push({date:u,stepName:x.step_name,customerName:o.customer_name});const v=x.step_name||"Layanan";e[c].statsByStep[v]||(e[c].statsByStep[v]=0),e[c].statsByStep[v]++}})})}),h.value=Object.values(e).sort((o,u)=>u.totalTasks-o.totalTasks)}function T(a){return a?a.substring(0,2).toUpperCase():"??"}function M(a){if(!a)return"-";const e=new Date(a);return e.toLocaleDateString("id-ID",{day:"numeric",month:"short"})+" "+e.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}function E(a){a.tasks.sort((e,s)=>new Date(s.date)-new Date(e.date)),l.value=a}return $(async()=>{await C(),await D()}),(a,e)=>(n(),r("div",z,[t("div",A,[e[6]||(e[6]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-800"},"Kinerja Terapis"),t("p",{class:"text-sm text-gray-500"},"Statistik pekerjaan dan layanan")],-1)),t("div",H,[B(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>p.startDate=s),class:"border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-pink-200"},null,512),[[j,p.startDate]]),e[5]||(e[5]=t("span",{class:"text-gray-400"},"-",-1)),B(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>p.endDate=s),class:"border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-pink-200"},null,512),[[j,p.endDate]]),t("button",{onClick:D,class:"bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-lg shadow-pink-200"}," Filter ")])]),t("div",R,[t("div",W,[t("table",Y,[e[9]||(e[9]=t("thead",null,[t("tr",{class:"bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-semibold tracking-wider"},[t("th",{class:"px-6 py-4"},"Nama Terapis"),t("th",{class:"px-6 py-4 text-left"},"Layanan"),t("th",{class:"px-6 py-4 text-center"},"Aksi")])],-1)),t("tbody",q,[b.value?(n(),r("tr",G,[...e[7]||(e[7]=[t("td",{colspan:"3",class:"px-6 py-8 text-center text-gray-400"},"Memuat data...",-1)])])):h.value.length===0?(n(),r("tr",J,[...e[8]||(e[8]=[t("td",{colspan:"3",class:"px-6 py-8 text-center text-gray-400"},"Tidak ada data Kinerja pada periode ini",-1)])])):g("",!0),(n(!0),r(f,null,m(h.value,s=>(n(),r("tr",{key:s.workerId,class:"hover:bg-gray-50 transition duration-150"},[t("td",Q,[t("div",X,[t("div",Z,i(T(s.name)),1),t("span",tt,i(s.name),1)])]),t("td",et,[t("div",st,[(n(!0),r(f,null,m(s.statsByStep,(d,o)=>(n(),r("span",{key:o,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-50 border border-gray-200 text-gray-600"},[I(i(o)+" ",1),t("span",at,"("+i(d)+")",1)]))),128))])]),t("td",nt,[t("button",{onClick:d=>E(s),class:"text-pink-600 hover:text-pink-800 text-sm font-medium hover:underline"},"Detail",8,ot)])]))),128))])])])]),(n(),K(U,{to:"body"},[l.value?(n(),r("div",{key:0,class:"fixed inset-0 z-[99] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",onClick:e[4]||(e[4]=P(s=>l.value=null,["self"]))},[t("div",rt,[t("div",lt,[t("h3",it,[t("span",dt,i(T(l.value.name)),1),e[10]||(e[10]=I(" Detail Kinerja: ",-1)),t("span",ct,i(l.value.name),1)]),t("button",{onClick:e[2]||(e[2]=s=>l.value=null),class:"text-gray-400 hover:text-gray-600 transition text-xl"},"Ã—")]),t("div",pt,[e[11]||(e[11]=t("h4",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3"},"Ringkasan Layanan",-1)),t("div",ut,[(n(!0),r(f,null,m(l.value.statsByStep,(s,d)=>(n(),r("div",{key:d,class:"px-3 py-1 bg-white border border-gray-200 rounded-lg text-xs font-medium text-gray-700 shadow-sm flex items-center gap-2"},[t("span",null,i(d),1),t("span",xt,i(s),1)]))),128)),Object.keys(l.value.statsByStep).length===0?(n(),r("div",yt,"Belum ada data.")):g("",!0)])]),t("div",gt,[t("table",ft,[e[13]||(e[13]=t("thead",{class:"bg-gray-50 text-xs text-gray-500 uppercase sticky top-0 backdrop-blur-md bg-opacity-95"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Tanggal"),t("th",{class:"px-4 py-3 text-left"},"Layanan"),t("th",{class:"px-4 py-3 text-left"},"Pelanggan")])],-1)),t("tbody",mt,[(n(!0),r(f,null,m(l.value.tasks,(s,d)=>(n(),r("tr",{key:d,class:"hover:bg-gray-50"},[t("td",bt,i(M(s.date)),1),t("td",ht,i(s.stepName),1),t("td",_t,i(s.customerName),1)]))),128)),l.value.tasks.length===0?(n(),r("tr",vt,[...e[12]||(e[12]=[t("td",{colspan:"3",class:"px-4 py-8 text-center text-gray-400"},"Belum ada layanan selesai.",-1)])])):g("",!0)])])]),t("div",kt,[t("span",wt,"Total: "+i(l.value.tasks.length)+" Layanan",1),t("button",{onClick:e[3]||(e[3]=s=>l.value=null),class:"px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50 font-medium text-gray-700 transition"},"Tutup")])])])):g("",!0)]))]))}},Bt=F(Dt,[["__scopeId","data-v-1ed5590a"]]);export{Bt as default};
